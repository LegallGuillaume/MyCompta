{% extends "body.html" %}

{% block script%}
<script>

    function reload_page()
    {
        document.location.reload(true);
    }

    $(document).ready(function()
    {
        $('#btn_new_client').click(function(e)
        {
            $('#newClient').modal('hide');
            var objs = {};
            var empty = false
            var l_array = []
            $('#newClient :input').each(function()
            {
                if($(this).attr('type') == 'checkbox')
                {
                    objs[$(this).attr('id')] = ($(this).prop('checked') ? 'True' : 'False');
                }
                else if($(this).attr('type') != 'button')
                {
                    var val = $(this).val();
                    if (val == '')
                    {
                        l_array.push($(this).attr('id').replace('-', ' '));
                        empty = true;
                    }
                    objs[$(this).attr('id')] = val;
                }
            });
            if(empty)
            {
                alert('Liste des champs non remplis: ' + l_array);
                return;
            }
            $.ajax({
                method: 'POST',
                url: '/clients',
                data: objs
            }).done(function()
            {
                $('#newClient :input').each(function()
                {
                    if($(this).attr('type') == 'checkbox')
                    {
                        $(this).prop('checked', false);
                    }
                    else if($(this).attr('type') != 'button')
                    {
                        $(this).val('');
                    }
                });
            });
            reload_page();
        });

        $('#confirmModel').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('clientname') // Extract info from data-* attributes
            var modal = $(this);
            modal.find('.modal-body p').text('Etês-vous sùr de vouloir supprimer le client: ' + recipient + ' ?');
            modal.find('#btn_supp_client').data('clientname', recipient);
        });

        $('#btn_supp_client').click(function()
        {
            var clientname = $(this).data('clientname');
            if(clientname != '')
            {
                remove_client(clientname);
                $(this).data('clientname', '');
            }

            $('#confirmModel').modal('hide');
            reload_page();
        });

        $(".custom-file-input").on("change", function() {
            var fileName = $(this).val().split('\\').pop();
            $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
        });
    });

    function remove_client(clientname)
    {
        $.ajax({
            method: 'POST',
            url: 'client-delete',
            data: {'client-name' : clientname}
        }).done(function()
        {
            reload_page();
        });
    }

</script>
{% endblock%}

{%block body%}

<div class="modal fade" id="newClient" tabindex="-1" role="dialog" aria-labelledby="newClientLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="newClientLabel">Nouveau Client</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <form>
                <div class="form-group">
                    <label for="client-name" class="col-form-label">Nom Société:</label>
                    <input type="text" class="form-control" id="client-name">
                </div>
                <div class="form-group">
                    <label for="client-adresse" class="col-form-label">Adresse:</label>
                    <input type="text" class="form-control" id="client-adresse">
                </div>
                <div class="form-group">
                    <label for="client-comp" class="col-form-label">Complement Adresse:</label>
                    <input type="text" class="form-control" id="client-comp">
                </div>
                <div class="form-group">
                    <label for="client-cp" class="col-form-label">Code Postal:</label>
                    <input type="text"  class="form-control" id="client-cp">
                </div>
                <div class="form-group">
                    <label for="client-cp" class="col-form-label">Ville:</label>
                    <input type="text"  class="form-control" id="client-ville">
                </div>
                <div class="form-group">
                    <label for="client-pays" class="col-form-label">Pays:</label>
                    <input type="text" class="form-control" id="client-pays">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
            <button type="button" class="btn btn-success" id="btn_new_client">Ajouter</button>
        </div>
        </div>
    </div>
</div>

<div class="modal fade" id="confirmModel" tabindex="-1" role="dialog" aria-labelledby="confirmModelLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="confirmModelLabel">Cofirmation !</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body"><p></p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Non</button>
              <button type="button" class="btn btn-danger" id="btn_supp_client" data-clientname="">Oui, supprimer</button>
            </div>
          </div>
        </div>
      </div>

<div class="row">

    <div class="col-lg-6 my-auto text-center">
        <button type="button" style="width:120px; height:120px;" class="btn btn-outline-success" data-toggle="modal" data-target="#newClient"><i style="font-size: 40px" class="fa fa-address-card"></i></button>
    </div>
    {% if not clients %}
    <div class="col-lg-6"></div>
    {%endif%}
    {%for c in clients%}
    <div class="col-lg-6">
        <div class="card mb-4 shadow" style="border: 0.10rem solid {{color.col7}}; background-color: transparent;">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between text-white" style="color: {{color.col7}}; background-color: {{color.col1}};">
                <div class="row" style="width: 100%;">
                    <div class="col-11 text-left">
                        <h6 class="m-0 font-weight-bold text-white" style="text-shadow: 1px 1px 2px {{color.col1}};">{{c.name}} <span class="badge badge-info"></span></h6>
                    </div>
                    <div class="col-1">
                        <button data-toggle="modal" data-target="#confirmModel" data-clientname="{{c.name}}" class="btn btn-danger btn-circle btn-sm">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-6">
                        <p class="font-weight-bold text-white">Adresse: </p>
                    </div>
                    <div class="col-sm-6">
                        <p class="text-white">{{c.adresse}}</p>
                    </div>
                </div>
                <div class="row" style="margin-top: -5px;">
                    <div class="col-sm-6">
                        <p class="font-weight-bold text-white">Complement Adresse: </p>
                    </div>
                    <div class="col-sm-6">
                        <p class="text-white">{{c.comp_adresse}}</p>
                    </div>
                </div>
                <div class="row" style="margin-top: -5px;">
                    <div class="col-sm-6">
                        <p class="font-weight-bold text-white">Code Postal: </p>
                    </div>
                    <div class="col-sm-6">
                        <p class="text-white">{{c.cp}}</p>
                    </div>
                </div>
                <div class="row" style="margin-top: -5px;">
                    <div class="col-sm-6">
                        <p class="font-weight-bold text-white">Ville: </p>
                    </div>
                    <div class="col-sm-6">
                        <p class="text-white">{{c.ville}}</p>
                    </div>
                </div>
                <div class="row" style="margin-top: -5px;">
                    <div class="col-sm-6">
                        <p class="font-weight-bold text-white">Pays: </p>
                    </div>
                    <div class="col-sm-6">
                        <p class="text-white">{{c.pays}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {%endfor%}
</div>

{%endblock%}